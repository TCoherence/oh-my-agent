memory:
  backend: sqlite
  path: ~/.oh-my-agent/runtime/memory.db
  max_turns: 20
  summary_max_chars: 500

skills:
  enabled: true
  path: skills/

access:
  # Optional owner-only mode. When set, only these user IDs can use the bot.
  # For Discord, use the numeric user ID as string.
  owner_user_ids: []

# Agent workspace (Layer 0 sandbox). Defaults to external path.
workspace: ~/.oh-my-agent/agent-workspace

# Short conversation (/ask) artifact workspace:
# each thread uses a transient subdir under root and is cleaned by TTL.
short_workspace:
  enabled: true
  root: ~/.oh-my-agent/agent-workspace/sessions
  ttl_hours: 24
  cleanup_interval_minutes: 1440

router:
  enabled: false
  provider: openai_compatible
  base_url: "https://<openai-compatible-endpoint>/v1"
  api_key_env: DEEPSEEK_API_KEY
  model: deepseek-chat
  timeout_seconds: 8
  max_retries: 1
  confidence_threshold: 0.55
  require_user_confirm: true

automations:
  enabled: false                      # global scheduler switch
  jobs:
    # - name: "daily-standup"
    #   enabled: true                    # optional, default true
    #   platform: discord
    #   channel_id: "${DISCORD_CHANNEL_ID}"
    #   delivery: channel                # "channel" (default) | "dm"
    #   thread_id: "1234567890123456789"   # optional for channel delivery
    #   target_user_id: "123456789012345678"  # optional for dm; defaults to first owner_user_ids
    #   prompt: "Summarize open TODOs and suggest top 3 coding tasks."
    #   agent: codex                         # optional: force a specific agent
    #   interval_seconds: 86400
    #   initial_delay_seconds: 10
    #   author: "scheduler"

runtime:
  enabled: true
  worker_concurrency: 3
  worktree_root: ~/.oh-my-agent/runtime/tasks
  default_agent: codex
  default_test_command: "pytest -q"
  default_max_steps: 8
  default_max_minutes: 20
  risk_profile: strict
  path_policy_mode: allow_all_with_denylist
  denied_paths: [".env", "config.yaml", ".workspace/**", ".git/**"]
  decision_ttl_minutes: 1440
  cleanup:
    enabled: true
    interval_minutes: 60
    retention_hours: 24
    prune_git_worktrees: true
  merge_gate:
    enabled: true
    auto_commit: true
    require_clean_repo: true
    preflight_check: true
    target_branch_mode: current
    commit_message_template: "runtime(task:{task_id}): {goal_short}"

gateway:
  channels:
    - platform: discord
      token: ${DISCORD_BOT_TOKEN}
      channel_id: "${DISCORD_CHANNEL_ID}"
      agents: [claude, codex, gemini]   # fallback 顺序，第一个失败自动切下一个

    # Slack 示例（暂未实现，留作占位）
    # - platform: slack
    #   token: ${SLACK_BOT_TOKEN}
    #   channel_id: "${SLACK_CHANNEL_ID}"
    #   agents: [claude]

agents:
  claude:
    type: cli
    cli_path: claude             # PATH 里的可执行文件名，或绝对路径
    max_turns: 25
    model: sonnet
    timeout: 300                 # 秒，超时后 fallback 下一个 agent
    allowed_tools: [Bash, Read, Write, Edit, Glob, Grep]
    # env_passthrough: [ANTHROPIC_API_KEY]  # env vars forwarded when workspace is set

  gemini:
    type: cli
    cli_path: gemini
    max_turns: 10
    model: gemini-3.0-flash
    timeout: 120                 # 默认比其他 agent 短，避免长时间卡住 fallback
    # env_passthrough: []

  codex:
    type: cli
    cli_path: codex
    model: gpt-5.3-codex
    timeout: 300
    skip_git_repo_check: true    # 非 trusted git 目录时可继续运行
    # env_passthrough: [OPENAI_API_KEY]

  # ----- API agents (deprecated since v0.4.0, use CLI agents instead) -----
  # anthropic_api:
  #   type: api
  #   provider: anthropic
  #   model: claude-sonnet-4-6
  #   api_key: ${ANTHROPIC_API_KEY}
  #   max_tokens: 8192
  #
  # openai_api:
  #   type: api
  #   provider: openai
  #   model: gpt-4o
  #   api_key: ${OPENAI_API_KEY}
  #   max_tokens: 4096
